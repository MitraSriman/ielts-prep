<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>IELTS CBT Practice Test</title>
<style>
body{font-family:Arial,Helvetica,sans-serif;margin:0;background:#f5f7fa}
header{background:#0a3d62;color:#fff;padding:15px;text-align:center}
.container{display:flex;height:calc(100vh - 60px)}
.left{width:60%;padding:20px;overflow-y:auto;background:#ffffff}
.right{width:40%;padding:20px;overflow-y:auto;border-left:1px solid #ddd;background:#fafafa}
.question{margin-bottom:15px}
.timer{font-weight:bold;color:#c0392b}
button{padding:8px 12px;margin:5px 0}
input, select{width:90%;padding:5px;margin-top:5px}
.map-img{width:100%;margin:10px 0;border:1px solid #ccc}
</style>
</head>
<body>
<header>
<h2>IELTS Academic – CBT Practice Test</h2>
<p class="timer" id="timer">Time: 60:00</p>
</header>
<div class="container">
<div class="left" id="passageArea"></div>
<div class="right" id="questionArea"></div>
</div>
<footer style="text-align:center;padding:10px">
<button onclick="loadReading()">Reading Test</button>
<button onclick="loadListening()">Listening Test</button>
<button onclick="submitTest()">Submit Test</button>
<button onclick="showHistory()">View Result History</button>
</footer>
<script>
// ===== TIMER =====
let time=3600; let timerInterval;
function startTimer(){
  clearInterval(timerInterval);
  timerInterval=setInterval(()=>{
    let m=Math.floor(time/60),s=time%60;
    document.getElementById('timer').innerText=`Time: ${m}:${s<10?'0':''}${s}`;
    if(time>0) time--;
  },1000);
}

// ===== READING SECTION =====
const readingPassages=[
  {title:"Passage 1: Urban Farming Revolution", text:`...long realistic passage 1 (200-300 words)...`},
  {title:"Passage 2: Sleep and Cognitive Performance", text:`...long realistic passage 2 (200-300 words)...`},
  {title:"Passage 3: History and Evolution of Paper", text:`...long realistic passage 3 (200-300 words)...`}
];

const readingQuestions=[ /* 40 questions distributed across passages with varied types */ ];
let currentReading=0;
function loadReading(){
  time=3600; startTimer();
  let p=readingPassages[currentReading];
  let html=`<h3>${p.title}</h3><p>${p.text}</p>`;
  readingQuestions.filter(q=>q.passage===currentReading).forEach((q,j)=>{
    if(q.type==='TFNG') html+=`<div class='question'><label>${j+1}. ${q.question}</label><br><select id='r${currentReading}_${j}'><option value=''>Select</option><option value='true'>True</option><option value='false'>False</option><option value='ng'>Not Given</option></select></div>`;
    else if(q.type==='MC') html+=`<div class='question'><label>${j+1}. ${q.question}</label><br><select id='r${currentReading}_${j}'><option value=''>Select</option>${q.options.map(o=>`<option value='${o}'>${o}</option>`).join('')}</select></div>`;
    else if(q.type==='SC') html+=`<div class='question'><label>${j+1}. ${q.question}</label><br><input type='text' id='r${currentReading}_${j}'></div>`;
  });
  document.getElementById('passageArea').innerHTML=html;
  document.getElementById('questionArea').innerHTML=`<button onclick='prevReading()'>Previous Passage</button> <button onclick='nextReading()'>Next Passage</button>`;
}
function nextReading(){if(currentReading<readingPassages.length-1){currentReading++; loadReading();}}
function prevReading(){if(currentReading>0){currentReading--; loadReading();}}

// ===== LISTENING SECTION =====
const listeningSections=[
  {part:"Part 1", audio:`Single speaker conversation script...`, questions:[/* 10 Qs */]},
  {part:"Part 2", audio:`Monologue script...`, questions:[/* 10 Qs */]},
  {part:"Part 3", audio:`Map/diagram description script...`, mapImage:"map_placeholder.png", questions:[/* 10 Qs */]},
  {part:"Part 4", audio:`Multi-person lecture script...`, questions:[/* 10 Qs */]}
];
let currentListening=0; let played=[false,false,false,false];
function playListening(i){if(played[i]){alert('Already played');return;} let u=new SpeechSynthesisUtterance(listeningSections[i].audio);u.lang='en-GB';u.rate=0.9; u.onend=()=>played[i]=true; speechSynthesis.speak(u);}
function loadListening(){
  time=2400; startTimer();
  let s=listeningSections[currentListening];
  let html=`<h3>${s.part}</h3><button onclick='playListening(${currentListening})'>▶ Play Audio</button>`;
  if(s.mapImage) html+=`<img src='${s.mapImage}' class='map-img'>`;
  s.questions.forEach((q,j)=>{html+=`<div class='question'><label>${j+1}. ${q.q}</label><br><input type='text' id='${q.id}'></div>`;});
  document.getElementById('passageArea').innerHTML=html;
  document.getElementById('questionArea').innerHTML=`<button onclick='prevListening()'>Previous Section</button> <button onclick='nextListening()'>Next Section</button>`;
}
function nextListening(){if(currentListening<listeningSections.length-1){currentListening++; loadListening();}}
function prevListening(){if(currentListening>0){currentListening--; loadListening();}}

// ===== SCORING & HISTORY =====
function band(score){if(score>=39)return 9;if(score>=37)return 8.5;if(score>=35)return 8;if(score>=32)return 7.5;if(score>=30)return 7;if(score>=26)return 6.5;if(score>=23)return 6;if(score>=18)return 5.5;if(score>=16)return 5;return 4.5;}
function saveResult(r,l){const history=JSON.parse(localStorage.getItem('ieltsHistory')||'[]'); history.push({date:new Date().toLocaleString(),reading:r,listening:l}); localStorage.setItem('ieltsHistory',JSON.stringify(history));}
function showHistory(){const history=JSON.parse(localStorage.getItem('ieltsHistory')||'[]'); if(history.length===0){alert('No results yet'); return;} alert(history.map(h=>`${h.date}\nReading: ${h.reading}/40 Listening: ${h.listening}/40`).join('\n\n'));}
function submitTest(){
  let r=0,l=0;
  readingQuestions.forEach((q,i)=>{let val=document.getElementById(`r${q.passage}_${i}`)?.value?.toLowerCase().trim(); if(val===q.answer.toLowerCase()) r++;});
  listeningSections.forEach(s=>s.questions.forEach(q=>{let val=document.getElementById(q.id)?.value?.toLowerCase().trim(); if(val===q.answer.toLowerCase()) l++;}));
  saveResult(r,l);
  alert(`Reading: ${r}/40 Band ${band(r)}\nListening: ${l}/40 Band ${band(l)}`);
}

// Load default
loadReading();
</script>
</body>
</html>
